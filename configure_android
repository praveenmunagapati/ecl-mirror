#!/bin/bash

# /opt/android/android-ndk-r5/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/arm-linux-androideabi-gcc -MMD -MP -MF /home/sylvain/workspace/hello-jni/obj/local/armeabi/objs-debug/hello-jni/ecl_boot.o.d -fpic -ffunction-sections -funwind-tables -fstack-protector -D__ARM_ARCH_5__ -D__ARM_ARCH_5T__ -D__ARM_ARCH_5E__ -D__ARM_ARCH_5TE__  -Wno-psabi -march=armv5te -mtune=xscale -msoft-float -mthumb -Os -fomit-frame-pointer -fno-strict-aliasing -finline-limit=64 -I/home/sylvain/workspace/hello-jni/jni -DANDROID -I/opt/ecl/android/include -I/opt/ecl/android/include/ecl -Wa,--noexecstack -O0 -g -I/opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/include -c  /home/sylvain/workspace/hello-jni/jni/ecl_boot.c -o /home/sylvain/workspace/hello-jni/obj/local/armeabi/objs-debug/hello-jni/ecl_boot.o
#/opt/android/android-ndk-r5/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/arm-linux-androideabi-g++ -Wl,-soname,libhello-jni.so -shared --sysroot=/opt/android/android-ndk-r5/platforms/android-9/arch-arm   /home/sylvain/workspace/hello-jni/obj/local/armeabi/objs-debug/hello-jni/hello-jni.o /home/sylvain/workspace/hello-jni/obj/local/armeabi/objs-debug/hello-jni/ecl_boot.o     /opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/lib/libc.so /opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/lib/libstdc++.so /opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/lib/libm.so   -Wl,--no-undefined -Wl,-z,noexecstack /opt/ecl/android/lib/libecl.a -Wl,-rpath-link=/opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/lib -lsupc++ -o /home/sylvain/workspace/hello-jni/obj/local/armeabi/libhello-jni.so

#/opt/android/android-ndk-r5/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/../libexec/gcc/arm-linux-androideabi/4.4.3/cc1 -quiet -I/home/sylvain/src/android/androidmono/MonoActivity/jni/mono/mono/metadata/ -I /home/sylvain/src/android/androidmono/MonoActivity/jni/PlatformPatches/ -I /home/sylvain/src/android/androidmono/MonoActivity/jni/mono/ -I /home/sylvain/src/android/androidmono/MonoActivity/jni/mono/mono/ -I /home/sylvain/src/android/androidmono/MonoActivity/jni/mono/eglib/src/ -I /home/sylvain/src/android/androidmono/MonoActivity/jni/mono/mono/mini/ -I /home/sylvain/src/android/androidmono/MonoActivity/jni/mono/libgc/include/ -I -Wa,--noexecstack -I/opt/android/android-ndk-r5/platforms/android-3/arch-arm/usr/include -iprefix /opt/android/android-ndk-r5/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/../lib/gcc/arm-linux-androideabi/4.4.3/ -MMD /home/sylvain/src/android/androidmono/MonoActivity/obj/local/armeabi/objs/monoruntimearm/cominterop.d -MF /home/sylvain/src/android/androidmono/MonoActivity/obj/local/armeabi/objs/monoruntimearm/cominterop.o.d -MP -MQ /home/sylvain/src/android/androidmono/MonoActivity/obj/local/armeabi/objs/monoruntimearm/cominterop.o -D__ARM_ARCH_5__ -D__ARM_ARCH_5T__ -D__ARM_ARCH_5E__ -D__ARM_ARCH_5TE__ -DANDROID -DHAVE_PWD_H -DHAVE_UNISTD_H -DGC_LINUX_THREADS=1 -D_REENTRANT=1 -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_DLFCN_H=1 -DSILENT=1 -DNO_SIGNALS=1 -DNO_EXECUTE_PERMISSION=1 -DJAVA_FINALIZATION=1 -DGC_GCJ_SUPPORT=1 -DATOMIC_UNCOLLECTABLE=1 -D_IN_LIBGC=1 -DGC_LINUX_THREADS -D_GNU_SOURCE -D_REENTRANT -DUSE_MMAP -DUSE_MUNMAP -D_FILE_OFFSET_BITS=64 -DNO_UNALIGNED_ACCESS -DGC_GCJ_SUPPORT=1 -DHAVE_CONFIG_H -DARM_FPU_VFP -DPLATFORM_ANDROID -DMONO_ASSEMBLIES="/data/data/com.koushikdutta.mono/assets/lib/" -DMONO_BINDIR="/data/data/com.koushikdutta.mono/assets/bin/" -DMONO_CFG_DIR="/data/data/com.koushikdutta.mono/assets/bin/" -DS_IWRITE=0200 -D__linux__ -DNDEBUG /home/sylvain/src/android/androidmono/MonoActivity/jni/mono/mono/metadata//cominterop.c -mbionic -quiet -dumpbase cominterop.c -march=armv5te -mtune=xscale -msoft-float -mfpu=vfp -auxbase-strip /home/sylvain/src/android/androidmono/MonoActivity/obj/local/armeabi/objs/monoruntimearm/cominterop.o -g -O2 -O3 -O2 -Wno-psabi -w -fpic -ffunction-sections -funwind-tables -fstack-protector -fomit-frame-pointer -fstrict-aliasing -funswitch-loops -finline-limit=300 -o /tmp/ccBwh6ef.s

export ANDROID_ROOT=/opt/android/android-ndk-r5
SYSROOT=$ANDROID_ROOT/platforms/android-9/arch-arm

export CC="$ANDROID_ROOT/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/arm-linux-androideabi-gcc"
export CXX="$ANDROID_ROOT/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/arm-linux-androideabi-g++"

#export CFLAGS="--sysroot=$SYSROOT -fpic -ffunction-sections -funwind-tables  -D__ARM_ARCH_5__ -D__ARM_ARCH_5T__ -D__ARM_ARCH_5E__ -D__ARM_ARCH_5TE__  -Wno-psabi -march=armv5te -mtune=xscale -msoft-float -Os -fomit-frame-pointer -fno-strict-aliasing -finline-limit=64 -DANDROID  -DPLATFORM_ANDROID -DIGNORE_DYNAMIC_LOADING -Wa,--noexecstack -O0 -g -I/opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/include"
#export CFLAGS="--sysroot=$SYSROOT -fpic -ffunction-sections -funwind-tables  -D__ARM_ARCH_5__ -D__ARM_ARCH_5T__ -D__ARM_ARCH_5E__ -D__ARM_ARCH_5TE__ -DGC_LINUX_THREADS=1 -D_REENTRANT=1 -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_DLFCN_H=1 -DSILENT=1 -DNO_SIGNALS=1 -DNO_EXECUTE_PERMISSION=1 -DJAVA_FINALIZATION=1 -DGC_GCJ_SUPPORT=1 -DATOMIC_UNCOLLECTABLE=1 -D_IN_LIBGC=1  -DGC_LINUX_THREADS -D_GNU_SOURCE -D_REENTRANT -DUSE_MMAP -DUSE_MUNMAP -D_FILE_OFFSET_BITS=64 -DNO_UNALIGNED_ACCESS -Wno-psabi -march=armv5te -mtune=xscale -msoft-float -Os -fomit-frame-pointer -fno-strict-aliasing -finline-limit=64 -DANDROID  -DPLATFORM_ANDROID -DIGNORE_DYNAMIC_LOADING -Wa,--noexecstack -O0  -I/opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/include"
export CFLAGS="--sysroot=$SYSROOT -fpic -ffunction-sections -funwind-tables  -D__ARM_ARCH_5__ -D__ARM_ARCH_5T__ -D__ARM_ARCH_5E__ -D__ARM_ARCH_5TE__ -DGC_LINUX_THREADS=1 -D_REENTRANT=1 -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_DLFCN_H=1 -DSILENT=1 -DNO_SIGNALS=1 -DNO_EXECUTE_PERMISSION=1 -DJAVA_FINALIZATION=1 -DGC_GCJ_SUPPORT=1 -DATOMIC_UNCOLLECTABLE=1 -D_IN_LIBGC=1  -DGC_LINUX_THREADS -D_GNU_SOURCE -D_REENTRANT -DUSE_MMAP -DUSE_MUNMAP -D_FILE_OFFSET_BITS=64 -DNO_UNALIGNED_ACCESS -Wno-psabi -march=armv5te -mtune=xscale -msoft-float -fomit-frame-pointer -fno-strict-aliasing -finline-limit=64 -DANDROID  -DPLATFORM_ANDROID -DIGNORE_DYNAMIC_LOADING -Wa,--noexecstack -O0 -g -I/opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/include"
export CXXFLAGS=$CFLAGS
#export LDFLAGS="--sysroot=$SYSROOT -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-rpath-link=/opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/lib  /opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/lib/libc.so  /opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/lib/libstdc++.so /opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/lib/libm.so -lsupc++"
export LDFLAGS="--sysroot=$SYSROOT -g -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-rpath-link=/opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/lib  /opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/lib/libc.so  /opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/lib/libstdc++.so /opt/android/android-ndk-r5/platforms/android-9/arch-arm/usr/lib/libm.so -lsupc++"
#export LD="$ANDROID_ROOT/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/arm-linux-androideabi-ld --sysroot=$SYSROOT"
export AR=$ANDROID_ROOT/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/arm-linux-androideabi-ar
export STRIP=$ANDROID_ROOT/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/arm-linux-androideabi-strip
export RANLIB=$ANDROID_ROOT/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/arm-linux-androideabi-ranlib
export CPPFLAGS="-I$ANDROID_ROOT/platforms/android-9/arch-arm/usr/include/"

enable_threads=yes

base_config_opts="\
	--disable-c99complex \
	--disable-longdouble \
	--disable-soname \
    	--disable-shared \
	--enable-unicode \
	--enable-threads=$enable_threads \
	--with-asdf=no \
	--with-bytecmp=builtin \
	--with-cmp=no \
	--with-clx=no \
	--with-debug-cflags=yes \
	--with-defsystem=no \
	--with-fpe=yes \
	--with-profile=no \
	--with-rt=no \
	--with-serve-event=no \
	--with-tcp=builtin \
	--with-x=no \
	--with-dffi=no"


./configure --host=arm-eabi $base_config_opts $*

